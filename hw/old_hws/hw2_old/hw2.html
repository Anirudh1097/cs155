<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0053)http://crypto.stanford.edu/cs155/hw_and_proj/hw2.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>CS155 Computer and Network Security HW 2</title> 
 
 
<link rel="stylesheet" type="text/css" href="./hw2_files/seclab.css"> 

<style type="text/css"> 
  .course-title, .quarter { margin: 0; }
  .deadline { color: #D00; font-weight: bold }
  .homeworks td { padding-bottom: 1em; }
  .admin-category, .main-link, .homework { font-weight: bold; font-size: larger; }
  .admin-category { width: 10em; }
  table#admin-items { margin-top: 1em; border-collapse: collapse; }
  img.icon {height:50px; width:50px;filter:none;}
  div.c1 {margin-bottom:.4em;}
</style> 
</head><body> 
<div id="inner-wrapper"> 
<div id="outer-wrapper"> 

<h1 id="header"><a href="http://crypto.stanford.edu/cs155/hw_and_proj/">
CS155: Computer and Network Security</a></h1> 

<div id="content" class="full course"> 
<div class="logo"><img src="./hw2_files/seclab-128.png" alt="Logo"></div>

<h1 class="course-title">CS155:  Homework #2</h1> 
<h3 class="quarter">Spring 2012</h3> 

<h3>Due: Saturday, May 26</h3>

<!-- ======================================================== -->
<hr><h3>Problem 1: Same-origin policy</h3>

<p>
The browser same-origin policy (SOP) consists of several different policies,
including an SOP for DOM access and an SOP for cookie access. 
The SOP for 
<a href="http://code.google.com/p/browsersec/wiki/Part2#Same-origin_policy_for_DOM_access">DOM access</a>
is based on the triple (protocol, host, port), while the SOP for 
<a href="http://code.google.com/p/browsersec/wiki/Part2#Same-origin_policy_for_cookies">sending cookies to sites</a>
involves the domain and path.
Cookies designated "secure" are sent by the browser over HTTPS only. 
In current browsers, reading document.cookie in an HTTP context does not reveal secure cookies.
</p>
<p>
Suppose the SOP for DOM access was defined using only host
and port (as was the case in Safari until Safari 3.0) and
did not include the protocol.  
</p>

<ol type="a"> 
<li> Explain how a network attacker could steal facebook.com cookies that are designated "secure". <br>  
<i>Hint:</i> A facebook user may login using a form served over
https, but then receive a facebook.com page served over http.  Try
injecting Javascript into the page served over http.</li>

<li> Under the same assumptions, is it possible for a <i>web</i>
attacker to steal facebook.com cookies that are designated "secure"?
Describe an attack or explain why you believe none exists.  Recall
that a web attacker can set up a malicious web site and operate a
browser to visit any site, but cannot intercept or forge network
packets.  Assume the user is willing to visit any site set up by the
web attacker, but the web attacker can only set up web sites at
domains other than facebook.com. For this part let's assume that
the facebook.com site has no XSS vulnerabilities. </li>

</ol>


<!-- ======================================================== -->
<hr><h3>Problem 2: User tracking </h3>

Most popular browsers let users block 3rd party cookies.  This makes
it more difficult for 3rd party sites, such as ad networks, to track
users across connections.  In class we described the HSTS header: a
security mechanism that lets a domain specify that all connections to
that domain must be over HTTPS.  Typically, browsers will record HSTS
headers even when they are provided by 3rd party domains.

Explain how a 3rd party can use HSTS to track a user across connections
even when the user's browser blocks 3rd party cookies.   Your goal is 
to identify when two independent HTTP requests sent one day apart (over 
independent TCP connections) are originating from the same browser.   
Assume that the user is behind a proxy servicing many machines 
so that the request's source IP address cannot be used to track the user.  



<!-- ======================================================== -->
<hr><h3>Problem 3: Secure open redirects </h3>

Many sites use public scripts that take a URL as a parameter and send
the browser to that URL.   For example, on LinkedIn, the following link is used
to redirect the browser to a user's personal homepage:
<blockquote>
http://www.linkedin.com/redirect?url=http://crypto.stanford.edu/cs155
</blockquote>
Sites use redirects to learn that the user clicked on an external
link.  Search engines, for example, use redirects to learn what search
result the user clicked on.

While open redirects are widely used, they pose a security risk.  A
phisher, for example, can create a LinkedIn phishing page and trick
the user into clicking on
<blockquote>
http://www.linkedin.com/redirect?url=http://phisher.com
</blockquote>
Clicking on this link will lead to the phishing page, but users may think 
are clicking on a link to LinkedIn.

Your goal is to design a secure redirect script that will only
redirect to URLs that the site approves.  Note that it is unreasonable
for the redirect script to maintain a whitelist of all allowed redirect 
targets.  First, external links are frequently added and removed.
Second, in the case of a search engine, all links are valid links.

<ol type="a"> 

 <li> A first idea is to rely on the Referer header.  In the case of
  LinkedIn, the redirect script would check that the Referer header is
  a LinkedIn page, and ignore all other redirect requests.  Explain
  why this approach does not work.  </li>


 <li> Propose a secure method.  That is, a single redirect script that
  will only redirect to URLs authorized by the site.  Make sure to
  describe your method in sufficient detail.  
  <br> Hint: use cryptography. </li>

</ol>

<!-- ======================================================== -->
<hr><h3>Problem 4:   Cookies </h3>

<ol type="a"> 
  <li> Explain what are httpOnly cookies.  </li>

  <li> What attack are httpOnly cookies intended to prevent? Give an
  example attack that does not work if the site uses httpOnly cookies,
  but works with normal cookies.  Make sure to provide a sketch of the 
  vulnerable code and the attack URL (ignoring URL encoding, e.g., do not 
  encode spaces)  </li>

  <li> Give an example XSS exploit where httpOnly cookies do not
  improve security.  </li>

</ol>


<!-- ======================================================== -->
<hr><h3>Problem 5:   DNS Rebinding </h3>
 
<p>
DNS rebinding is an attack that uses DNS to subvert the same-origin policy in web browsers. In effect, a limitation of the same-origin policy is that it depends on domain names. Therefore, if an attacker is able to manipulate the meaning of domain names, the attacker can overcome restrictions imposed by the same-origin policy. There is an illustration of DNS rebinding in the lecture slides. The information you need about DNS is covered in the assigned reading called <i>A Security Evaluation of DNSSEC with NSEC3.</i>
 
</p><p>
In the example shown in the lecture slide, a web user wants to visit a site <tt>www.evil.com</tt> whose web page and DNS server are controlled by a malicious attacker.  The malicious DNS server for <tt>evil.com</tt> returns an IP address 171.64.7.115  for <tt>www.evil.com</tt>. An unusual part of the RR from the DNS server is that it has a short Time To Live (TTL) of 0.
Based on the response from the DNS server, the web user retrieves a web page from  171.64.7.115 that may contain malicious JavaScript.
The web user then requests the page at <tt>www.evil.com</tt> again. This time, the <tt>evil.com</tt> DNS server returns 192.168.0.100. 
If the web browser implements the same-origin policy as we have discussed in class, then web browser will let JavaScript downloaded from <tt>www.evil.com</tt> access content associated with 192.168.0.100.
 
</p><ol type="a">
<li> This attack assumes that the web user visits a malicious site.
Give three ways that an attacker may attract honest users to their site.
(Do not assume that the malicious site is actually called  <tt>evil.com</tt>.)
</li>
 
<li>
How can the content from 171.64.7.115 cause the user's browser send the second http request to <tt>www.evil.com</tt>.
</li>
 
<li>
Why does the second request for <tt>www.evil.com</tt> cause a second request to the <tt>evil.com</tt> DNS server?
</li>
  
<li>
Suppose that the page at 192.168.0.100 contains names and addresses of the corporate employees, organized in a systematic way.
How can the attacker controlling <tt>evil.com</tt> send this information ba</li></ol></div></div></div></body></html>